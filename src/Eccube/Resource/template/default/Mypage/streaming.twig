{#
This file is part of EC-CUBE

Copyright(c) 2000-2015 LOCKON CO.,LTD. All Rights Reserved.

http://www.lockon.co.jp/

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
#}
{% extends 'default_frame.twig' %}

{% set mypageno = 'streaming' %}

{% set body_class = 'mypage' %}

{% block stylesheet %}
    <link href="http://vjs.zencdn.net/5.19.1/video-js.css" rel="stylesheet">
{% endblock stylesheet %}

{% block javascript %}
    <script src="http://vjs.zencdn.net/5.19.1/video.js"></script>
    <script>
        // 表示件数を変更
        function fnChangeDispNumber(dispNumber) {
            $("#page_navi_top").submit();
        }

        function  fnIconClick(productId) {
            $("#favorite_product_" + productId + " .btn_circle").css("backgroundColor", "whitesmoke");
            $("#favorite_product_" + productId + " .btn_circle .cb-heart").css("color", "red");
            $.ajax({
                type: 'POST',
                data: {
                    'product_id' : productId
                },
                url: '{{ url('streaming_favorite') }}',
                success: function(data) {

                },
                error: function() {
                    console.log('ajax failed');
                }
            });
        }
        
        function fnImageClick(image) {
            var player = videojs('my-video');
            var poster = $("#my-video").attr("poster");
            poster += "/" + image;
            $('.vjs-poster').css('background-image', "url(" + poster + ")");
            $('#video_box').show();
        }
        
        $(document).ready(function () {
            $(".heart").change(function () {
                $("#page_navi_top").submit();
            });

        });
        // 商品表示BOXの高さを揃える
        $(window).load(function() {
            $('.product_item').matchHeight();
        });
    </script>
{% endblock %}

{% block main %}
    <h1 class="page-heading">マイページ/ストリーミング動画</h1>
    <div id="favorite_wrap" class="container-fluid">
        {% include 'Mypage/navi.twig' %}
        <!-- ▲topicpath▲ -->
        <div id="result_info_box" class="row">
            <form name="page_navi_top" id="page_navi_top" action="?">
                <div id="search" class="col-sm-6 no-padding search">
                    <div class="input_search clearfix" style="padding: 0 10px 0 1em;">
                        <input type="search" id="name" name="name" maxlength="50" placeholder="動画名・動画情報" style="width: 50%;" value="{{ form.name.vars.value }}">
                        <select id="" name="orderby" onchange="javascript:fnChangeOrderBy(this.value);" class="form-control" style="max-width: 210px;">
                            <option value="4" {% if orderby == 4 %} selected {% endif %}>購入日が新しい順</option>
                            <option value="5" {% if orderby == 5 %} selected {% endif %}>購入日が古い順</option>
                        </select>
                        <button class="btn-danger btn" type="submit">更新</button>
                    </div>
                </div>

                <div id="result_info_box__menu_box" class="col-sm-6 no-padding col-sm-offset-6">
                    <ul id="result_info_box__menu" class="pagenumberarea clearfix">
                        <span style="color: red;">&hearts;</span>付き商品のみを
                        <li id="search" class="search" style="cursor: pointer;">
                            <input type="radio" name="heart" id="heart1" class="heart" autocomplete="off" {% if heart == 1 or heart is empty %} checked {% endif %} value="1" style="cursor: pointer;">
                            <label for="heart1">表示</label>
                            <input type="radio" name="heart" id="heart2" class="heart" autocomplete="off" {% if heart == 2 %} checked {% endif %} value="2" style="cursor: pointer;">
                            <label for="heart2">解除</label>
                            {{ form_widget(disp_number_form, {'id': '', 'attr': {'onchange': "javascript:fnChangeDispNumber(this.value);"}}) }}
                        </li>
                    </ul>
                </div>
            </form>
        </div>

        <div id="video_box" class="col-sm-9 col-lg-10 col-sm-offset-2" style="display: none;">
            <video id="my-video" class="video-js vjs-default-skin" controls preload="auto" width="700" height="395" poster="{{ app.config.image_save_urlpath }}" data-setup="{}">
                <source src="{{ app.config.user_data_urlpath }}/video/oceans.mp4" type='video/mp4'>
                <p class="vjs-no-js">
                    To view this video please enable JavaScript, and consider upgrading to a web browser that
                    <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
                </p>
            </video>
        </div>

        <div id="favorite_list_box" class="row">
            <div id="favorite_list_box__body" class="col-md-12">
            {% if pagination.totalItemCount > 0 %}
                <p id="favorite_lst__total_item_count" class="intro"><strong>{{ pagination.totalItemCount }}件</strong>のストリーミング動画があります。</p>
                <div id="item_list">
                    <div id="favorite_list__list" class="row no-padding">
                        {% for Order in pagination %}
                            {% for OrderDetail in Order.OrderDetails %}
                                {% set Product = OrderDetail.Product %}
                                {% set flag = false %}
                                {% set FavoriteProducts = Order.Customer.CustomerFavoriteProducts %}
                                {% for Favorite in FavoriteProducts %}
                                    {% if Favorite.Product.id == Product.id %}
                                        {% set flag = true %}
                                    {% endif %}
                                {% endfor %}
                                    <div id="favorite__list--{{ Product.id }}" class="col-sm-3 col-xs-6">
                                        <div id="favorite_list__item--{{ Product.id }}" class="product_item">
                                            <a href="javascript:void(0)" onclick="fnImageClick('{{ Product.main_list_image|no_image_product }}');">
                                                <div id="favorite_list__image--{{ Product.id }}" class="item_photo">
                                                    <img src="{{ app.config.image_save_urlpath }}/{{ Product.main_list_image|no_image_product }}" alt="{{ Product.name }}"/>
                                                </div>
                                            </a>
                                            <a href="javascript:void(0)" onclick="fnIconClick({{ Product.id }});" id="favorite_product_{{ Product.id }}">
                                                <button type="button" class="btn_circle"  {% if flag == true %} style="background-color: whitesmoke;" {% endif %}><svg class="cb cb-heart" {% if flag == true %} style="color: red;" {% endif %}><use xlink:href="#cb-heart"></use></svg></button>
                                            </a>

                                                <dl id="favorite_list__detail--{{ Product.id }}">
                                                    <dt id="favorite_list__name--{{ Product.id }}" class="item_name" style="height: 22px;"> {{ Product.name }}</dt>
                                                </dl>

                                        </div>
                                    </div>

                            {% endfor %}
                        {% endfor %}
                    </div>
                </div>
                <div id="favorite_list__pagination" class="paging">
                    {% include "pagination.twig" with {'pages': pagination.paginationData} %}
                </div>
            {% else %}
                <p id="favorite_list__not_found_message" class="intro">ストリーミング動画が登録されていません。</p>
            {% endif %}
            </div>
        </div>
    </div>
{% endblock %}
